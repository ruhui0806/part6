{"ast":null,"code":"import { canUseAsyncIteratorSymbol } from \"../../../utilities/index.js\";\nexport default function nodeStreamIterator(stream) {\n  var cleanup = null;\n  var error = null;\n  var done = false;\n  var data = [];\n  var waiting = [];\n\n  function onData(chunk) {\n    if (error) return;\n\n    if (waiting.length) {\n      var shiftedArr = waiting.shift();\n\n      if (Array.isArray(shiftedArr) && shiftedArr[0]) {\n        return shiftedArr[0]({\n          value: chunk,\n          done: false\n        });\n      }\n    }\n\n    data.push(chunk);\n  }\n\n  function onError(err) {\n    error = err;\n    var all = waiting.slice();\n    all.forEach(function (pair) {\n      pair[1](err);\n    });\n    !cleanup || cleanup();\n  }\n\n  function onEnd() {\n    done = true;\n    var all = waiting.slice();\n    all.forEach(function (pair) {\n      pair[0]({\n        value: undefined,\n        done: true\n      });\n    });\n    !cleanup || cleanup();\n  }\n\n  cleanup = function () {\n    cleanup = null;\n    stream.removeListener(\"data\", onData);\n    stream.removeListener(\"error\", onError);\n    stream.removeListener(\"end\", onEnd);\n    stream.removeListener(\"finish\", onEnd);\n    stream.removeListener(\"close\", onEnd);\n  };\n\n  stream.on(\"data\", onData);\n  stream.on(\"error\", onError);\n  stream.on(\"end\", onEnd);\n  stream.on(\"finish\", onEnd);\n  stream.on(\"close\", onEnd);\n\n  function getNext() {\n    return new Promise(function (resolve, reject) {\n      if (error) return reject(error);\n      if (data.length) return resolve({\n        value: data.shift(),\n        done: false\n      });\n      if (done) return resolve({\n        value: undefined,\n        done: true\n      });\n      waiting.push([resolve, reject]);\n    });\n  }\n\n  var iterator = {\n    next: function () {\n      return getNext();\n    }\n  };\n\n  if (canUseAsyncIteratorSymbol) {\n    iterator[Symbol.asyncIterator] = function () {\n      return this;\n    };\n  }\n\n  return iterator;\n}","map":{"version":3,"mappings":"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","names":["canUseAsyncIteratorSymbol","nodeStreamIterator","stream","cleanup","error","done","data","waiting","onData","chunk","length","shiftedArr","shift","Array","isArray","value","push","onError","err","all","slice","forEach","pair","onEnd","undefined","removeListener","on","getNext","Promise","resolve","reject","iterator","next","Symbol","asyncIterator"],"sources":["/Users/kulta/Code/part6/graphql-phonebook-frontend/node_modules/@apollo/src/link/http/iterators/nodeStream.ts"],"sourcesContent":["/**\n * Original source:\n * https://github.com/kmalakoff/response-iterator/blob/master/src/iterators/nodeStream.ts\n */\n\nimport { Readable as NodeReadableStream } from \"stream\";\nimport { canUseAsyncIteratorSymbol } from \"../../../utilities\";\n\ninterface NodeStreamIterator<T> {\n  next(): Promise<IteratorResult<T, boolean | undefined>>;\n  [Symbol.asyncIterator]?(): AsyncIterator<T>;\n}\n\nexport default function nodeStreamIterator<T>(\n  stream: NodeReadableStream\n): AsyncIterableIterator<T> {\n  let cleanup: (() => void) | null = null;\n  let error: Error | null = null;\n  let done = false;\n  const data: unknown[] = [];\n\n  const waiting: [\n    (\n      value:\n        | IteratorResult<T, boolean | undefined>\n        | PromiseLike<IteratorResult<T, boolean | undefined>>\n    ) => void,\n    (reason?: any) => void\n  ][] = [];\n\n  function onData(chunk: any) {\n    if (error) return;\n    if (waiting.length) {\n      const shiftedArr = waiting.shift();\n      if (Array.isArray(shiftedArr) && shiftedArr[0]) {\n        return shiftedArr[0]({ value: chunk, done: false });\n      }\n    }\n    data.push(chunk);\n  }\n  function onError(err: Error) {\n    error = err;\n    const all = waiting.slice();\n    all.forEach(function (pair) {\n      pair[1](err);\n    });\n    !cleanup || cleanup();\n  }\n  function onEnd() {\n    done = true;\n    const all = waiting.slice();\n    all.forEach(function (pair) {\n      pair[0]({ value: undefined, done: true });\n    });\n    !cleanup || cleanup();\n  }\n\n  cleanup = function () {\n    cleanup = null;\n    stream.removeListener(\"data\", onData);\n    stream.removeListener(\"error\", onError);\n    stream.removeListener(\"end\", onEnd);\n    stream.removeListener(\"finish\", onEnd);\n    stream.removeListener(\"close\", onEnd);\n  };\n  stream.on(\"data\", onData);\n  stream.on(\"error\", onError);\n  stream.on(\"end\", onEnd);\n  stream.on(\"finish\", onEnd);\n  stream.on(\"close\", onEnd);\n\n  function getNext(): Promise<IteratorResult<T, boolean | undefined>> {\n    return new Promise(function (resolve, reject) {\n      if (error) return reject(error);\n      if (data.length) return resolve({ value: data.shift() as T, done: false });\n      if (done) return resolve({ value: undefined, done: true });\n      waiting.push([resolve, reject]);\n    });\n  }\n\n  const iterator: NodeStreamIterator<T> = {\n    next(): Promise<IteratorResult<T, boolean | undefined>> {\n      return getNext();\n    },\n  };\n\n  if (canUseAsyncIteratorSymbol) {\n    iterator[Symbol.asyncIterator] = function (): AsyncIterator<T> {\n      return this;\n    };\n  }\n\n  return iterator as AsyncIterableIterator<T>;\n}\n"]},"metadata":{},"sourceType":"module"}